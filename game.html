<!DOCTYPE html>
<html lang="en">
<head>
    <title>Clove Cards</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Clove Cards, Card Game">
    <meta name="description" content="An online card game!">
    <meta name="author" content="Sapphire7x and Savanna Campbell">
</head>
<body>
    <header>
        <!--<div>
            <img>
        </div>
        <nav>
            <ul></ul>
        </nav>-->
    </header>
    <main>
        <span class="deckings" style="display: none;"></span>
        <h1>Play the Game!</h1>
        <div id="clear">
            <h2 id="cardsHeader">Cards:</h2>
            <h2 id="decksHeader">Decks:</h2>
            <button id="newDeckButton" style="display: block;">New Deck!</button>
            <span id="afterDecks" style="display: none;"></span>
        </div>
    </main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> <!--jQuery!-->
    <script src="scripts/game.js"></script> <!--Calls game.js file-->
    <script>
        var strings; //define strings as a global variable.
        var yourCards = yourCardsData;
        var activeDeck = activeDeckData;
        var decks = decksData;
        function updateStorage() {
            if(!localStorage.yourCards) {
                localStorage.setItem("yourCards", JSON.stringify(yourCards))
            } else {
                localStorage.yourCards = JSON.stringify(yourCards)
            }
            if(!localStorage.activeDeck) {
                localStorage.setItem("activeDeck", JSON.stringify(activeDeck))
            } else {
                localStorage.activeDeck = JSON.stringify(activeDeck)
            }
            if(!localStorage.decks) {
                localStorage.setItem("decks", JSON.stringify(decks))
            } else {
                console.log(JSON.stringify(decks))
                localStorage.decks = JSON.stringify(decks)
                console.log("what?")
            }
        }
        function showDecks(first) {
            /*localStorage.removeItem("yourCards")
            localStorage.removeItem("activeDeck")
            localStorage.removeItem("decks")*/
            if(!localStorage.yourCards) {
                localStorage.setItem("yourCards", JSON.stringify(yourCards))
            } else {
                //yourCards = localStorage.yourCards
                if(!first) localStorage.yourCards = JSON.stringify(yourCards)
            }
            if(!localStorage.activeDeck) {
                
                localStorage.setItem("activeDeck", JSON.stringify(activeDeck))
            } else {
                //activeDecks = localStorage.activeDecks
                if(!first) localStorage.activeDeck = JSON.stringify(activeDeck)
            }
            if(!localStorage.decks) {
                localStorage.setItem("decks", JSON.stringify(decks))
            } else {
                console.log(JSON.stringify(decks))
                //decks = localStorage.decks
                if(!first) localStorage.decks = JSON.stringify(decks)
                console.log("what?")
            }
            if(localStorage.yourCards) {
                console.log("hello")
                yourCards = JSON.parse(localStorage.yourCards)
            }
            if(localStorage.activeDeck) {
                console.log("what")
                activeDeck = JSON.parse(localStorage.activeDeck)
            }
            if(localStorage.decks) {
                console.log("de c k s")
                decks = JSON.parse(localStorage.decks)
            }
            
            for(l in decks) {
                decks[l]=decks[l].filter(function(el) { return el; })
            }
            
            $("#clear").html('<h2 id="cardsHeader">Cards:</h2><h2 id="decksHeader">Decks:</h2><button id="newDeckButton" style="display: block;">New Deck!</button><span id="afterDecks" style="display: none;"></span>') //clears the screen and readds the framework that should appear every time.
            var precount = 1; //this is a precount. It goes up every time you run the for loop.
            for(i in yourCards) {
                $("#cardsHeader").after("<span class='card'>" + yourCards[i] + "</span><span id='" + precount + "' style='display: none;'></span> ")
                //This shows you all of your cards and then prepares a panel that asks which deck you want it to be in.
                precount++ //increment precount.
            }
            var counter = 1; //this is like another precount just different.
            var otherCount = 1; //lol ^
            for(j in decks) {
                //console.log(Array(decks[j]))
                //console.log(Array(decks[j]).join("</span><span id='deck"+counter+"''>"))
                //$("#afterDecks").before("<h3>Deck "+counter+"</h3><span id='deck1'>" + Array(decks[j]).join("</span><span id='deck"+counter+"''>") + "</span>")
                $("#afterDecks").before("<h3 id='deck" + j + "' style='display: inline;'>Deck "+counter+"</h3><button class='removeDeckButton' style='display: inline;'>Delete Deck</button><span class='youSure' style='display: none;'>Are you sure? <span class='theyChoseYes'>Yes</span> | <span class='theyChoseNo'>No</span></span><div id='deck" + j + "div'></div>") //this sets the titles for each deck.
                for(k in decks[j]) { //this goes through the cards of each deck.
                    $("#deck"+j+"div").append("<span class='cardRemove "+k+"'>" + decks[j][k] + "</span><span class='deckCard' style='display: none;'>Remove from deck? <span class='yesChoice'>Yes</span> | <span class='noChoice'>No</span></span> ")
                    //This shows all the cards in that deck and prepares a panel that asks if you wish to remove it from that deck.
                    otherCount++ //increment otherCount.
                }
                counter++ //increment counter.
            }
            strings = []; //define strings as an array.
            //console.log(counter)
            //this is for the popup panel that shows when you click on a card to add it to a deck.
            for(k = 0; k < (counter-1); k++) {
                strings.push('<span class = "deckings">Deck ' + (Number(k) + 1) + "</span>")
            }
            $(".card").click(function(){
                $(this).next()
                    .css("display", "block")
                    .html("Decks: " + strings.join(" | ") + " | <span class='close'>Close</span>")
                //$(".deckings").css("background", "red")
                $(".close").click(function(){
                    showDecks();
                })
                $(".deckings").click(function(){
                    let count1 = {};
                    let count2 = {};
                    //console.log($(this).html().startsWith("Deck"))
                    if($(this).html().startsWith("Deck")) {
                        //console.log($(this).html().replace("Deck ", "")-1)
                        decks[$(this).html().replace("Deck ", "")-1].forEach(e => count1[e] ? count1[e]++ : count1[e] = 1 );
                        yourCards.forEach(e => count2[e] ? count2[e]++ : count2[e] = 1 );
                        //console.log(count1)
                        //console.log(count2)
                        //console.log($(this).parent().prev().html())
                        if(count1[$(this).parent().prev().html()]>=count2[$(this).parent().prev().html()]) {
                            $(this).html("You don't have enough of this card to add it to that deck!")
                        } else{
                            //console.log(count)
                            decks[$(this).html().replace("Deck ", "")-1].push($(this).parent().prev().html())
                            //console.log("hi!")
                            showDecks()
                        }
                    }
                    
                }) //This is sort of working now.
            })
            $("#deck"+activeDeck).after($("<span class='activeDeck'> - <i>Active Deck</i></span>"))
            for(let m in decks) {
                if(m != activeDeck) {
                    $("#deck"+m).after($("<button class='activeDeckButton' style='display: inline;'>Set as Active Deck</button>"))
                }
            }
            $(".activeDeckButton").click(function(){
                activeDeck = $(this).prev().attr("id").replace("deck", "")
                showDecks();
            })
            $(".cardRemove").click(function(){
                $(this).next()
                    .css("display", "block")
                //$(".deckings").css("background", "red")
                $(".noChoice").click(function(){
                    showDecks()
                }) //This is sort of working now.
                $(".yesChoice").click(function(){
                    decks[$(this).parent().parent().attr('id').replace("deck", "").replace("div", "")].splice($(this).parent().prev().attr("class").replace("cardRemove", "").replace(" ", ""), 1) //preved in the wrong spot- removing wrong element from array.
                    showDecks()
                })
            })
            $("#newDeckButton").click(function(){
                decks.push([])
                showDecks()
                console.log("hello")
            })
            $(".removeDeckButton").click(function(){
                $(this).next().css("display", "block")
                $(".theyChoseYes").click(function(){
                    decks.splice($(this).parent().prev().prev().prev().attr("id").replace("deck", ""), 1)
                    activeDeck = 0;
                    showDecks()
                })
                $(".theyChoseNo").click(function(){
                    showDecks()
                })
            })
            /* console.log(yourCards)
            console.log(activeDeck)
            console.log(decks) */
            console.log("it is finished.")
        }
        showDecks(true);
        /*$(".card").click(function(){
            $(this).next()
                .css("display", "block")
                .html("Decks: " + strings.join(" | "))
            //$(".deckings").css("background", "red")
            $(".deckings").click(function(){
                console.log("hi")
                decks[$(this).html().replace("Deck ", "")].push($(this).parent().prev().html())
                console.log("hi!")
                showDecks()
            }) //This is sort of working now.
        })*/
        
        //console.log(decks)
    </script>
</body>
</html>
