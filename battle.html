<!DOCTYPE html>
<html lang="en">
<head>
    <title>Clove Cards</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Clove Cards, Card Game">
    <meta name="description" content="An online card game!">
    <meta name="author" content="Sapphire7x and Savanna Campbell">
</head>
<body>
    <header>
        <!--<div>
            <img>
        </div>
        <nav>
            <ul></ul>
        </nav>-->
    </header>
    <main>
        <h1>Play the Game!</h1>
        <span id="turnCount"></span>
        <div id="board">
            <button class="1 endTurn" onclick="changeTurns()" style="display: none;">End Turn</button>
            <button class="1 draw" style="display: none;">Draw</button>
            <div class="1 deck" onclick="shuffleDeck(1)"></div> <!-- this won't show anymore 'caus we show hands now-->
            <div class="1 hand"></div> <!-- here is your board -->
            <div class="1 played"></div>
            <div class="1 discard"></div>
            <div class="2 played"></div>
            <div class="2 discard"></div>
            <div class="2 hand"></div>
            <div class="2 deck"></div>
            <button class="2 draw" style="display: none;">Draw</button> <!-- draw button -->
            <button class="2 endTurn" onclick="changeTurns()" style="display: none;">End Turn</button> <!-- end turn button -->
        </div>
        <!--<button class="testbutton">click me to add cards to your collection!</button>-->
    </main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> <!--jQuery!-->
    <script src="scripts/game.js"></script> <!--Calls game.js file-->
    <script src="scripts/functions.js"></script><!--Calls functions.js file-->
    
    <script src="scripts/onOpen.js"></script> <!--Calls the onOpen.js file-->
    <script>
        //create an array for every card
        var listOfCards = decks[activeDeck].concat(decks[activeDeckPlayerTwo])
        //active player is player one at the beginning
        var activePlayer = 1;
        // set the turn count variable
        var turnCount = 1;
        //create a variable that will update when it's time to update the turn.
        var updateTurn = false;
        // create a variable that will update if you've played a card.
        var playedCardYet = false;
        // create a board variable with just the decks so far.
        var board = {
            player1Deck: decks[activeDeck],
            player1Hand: [],
            player1Played: [],
            player1Discard: [],
            player2Deck: decks[activeDeckPlayerTwo],
            player2Hand: [],
            player2Played: [],
            player2Discard: []
        }
        //create a shuffle function
        function shuffle(array) {
            let currentIndex = array.length; //there are this many cards in the array
            let temporaryValue; //temporary value
            let randomIndex; //random value
            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1; //Lower the currentIndex

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }  
            // return the array
            return array;
        }
        function returnArray(array) { //function to return an array
            return array;
        }
        function sortCards(array, required) { //sort an array
            array = array.sort() //sort it
            returnArray(array) //return it
            if(required) displayBoard() //if required, then also show the board. <-- change this to show played cards?
        }
        function shuffleDeck(deckNumber) {
            //Set the deck to the deck but shuffled
            board["player" + deckNumber + "Deck"] = shuffle(board["player" + deckNumber + "Deck"])
        }
        function changeTurns() { //function to change turns
            activePlayer = (activePlayer)%2+1 //change the active player to 1/2, the other one.
            turnCount++ //update turncount
            updateTurn = true; //set update turn to true so effective changes can take place.
            displayBoard(); //display the board again.
        }
        function drawFromDeck() {
            //nothing -- placeholder.
        }
        if(!eligibleDeckOne) { //if deck one isn't eligible then display that.
            $("main").html("Deck One isn't eligible to play the game!")
        } else if(!eligibleDeckTwo) { //if deck two isn't eligible then display that.
            $("main").html("Deck Two isn't eligible to play the game!")
        } else { //if both decks are eligible.
            //change each card in board to ["name", id] 
            for(h in board.player1Deck) {
                board.player1Deck[h] = [board.player1Deck[h], h]
            }
            for(g in board.player2Deck) { //same thing but for player2.
                board.player2Deck[g] = [board.player2Deck[g], Number(g)+10]
            }
            
            var copyOfBoard = JSON.parse(JSON.stringify(board)) //create a copy of the board that doesnt change with it.
            var cardData = {
                card0: [cards[board.player1Deck[0][0]].Health, false],
                card1: [cards[board.player1Deck[1][0]].Health, false],
                card2: [cards[board.player1Deck[2][0]].Health, false],
                card3: [cards[board.player1Deck[3][0]].Health, false],
                card4: [cards[board.player1Deck[4][0]].Health, false],
                card5: [cards[board.player1Deck[5][0]].Health, false],
                card6: [cards[board.player1Deck[6][0]].Health, false],
                card7: [cards[board.player1Deck[7][0]].Health, false],
                card8: [cards[board.player1Deck[8][0]].Health, false],
                card9: [cards[board.player1Deck[9][0]].Health, false],
                card10: [cards[board.player2Deck[0][0]].Health, false],
                card11: [cards[board.player2Deck[1][0]].Health, false],
                card12: [cards[board.player2Deck[2][0]].Health, false],
                card13: [cards[board.player2Deck[3][0]].Health, false],
                card14: [cards[board.player2Deck[4][0]].Health, false],
                card15: [cards[board.player2Deck[5][0]].Health, false],
                card16: [cards[board.player2Deck[6][0]].Health, false],
                card17: [cards[board.player2Deck[7][0]].Health, false],
                card18: [cards[board.player2Deck[8][0]].Health, false],
                card19: [cards[board.player2Deck[9][0]].Health, false]
            } //set card data; each card: health, and whether or not the card was used this turn.

            for(i in cardData) {
                //for every card
                if(Number(i.replace("card", ""))<10) { //if the card id is less than 10
                    let newObject = {}; //create a new object
                    for(j in cards[board.player1Deck[i.replace("card", "")][0]]["Abilities"]) {
                        //for each of the cards abilities
                        newObject[Object.values(cards[board.player1Deck[i.replace("card", "")][0]]["Abilities"][j])[0]] = 0;
                        //add to new object theabilityid: 0
                        //the zero represents how many times the ability was used
                    }
                    cardData[i].push(newObject) //push it to cardData
                } else {
                    //same thing but if the card is 10-20
                    let newObject = {};
                    for(j in cards[board.player2Deck[Number(i.replace("card", ""))-10][0]]["Abilities"]) {
                        newObject[Object.values(cards[board.player2Deck[Number(i.replace("card", ""))-10][0]]["Abilities"][j])[0]] = 0;
                    }
                    cardData[i].push(newObject)
                }
            }
            shuffleDeck(1) //shuffle each of the deccks
            shuffleDeck(2)
            decks = JSON.parse(JSON.stringify(decks)) //decks = decks.
            var playerDecks = { //set a new variable for each deck.
                playerDeck1: decks[activeDeck],
                playerDeck2: decks[activeDeckPlayerTwo]
            }
            //split the shuffled deck into a hand and deck, hand with 4 cards each.
            board.player1Hand = board.player1Deck.splice(0, 4)
            board.player2Hand = board.player2Deck.splice(0, 4)
            
            function displayBoard() { //display the board function
                if(updateTurn) { //if you have to update turn
                    for(let d in cardData) {
                        cardData[d][1]=false; //reset every played card thing to false.
                    }
                    playedCardYet = false; //you have not played a card yet this new turn
                    updateTurn = false; //you no longer need to update your turn.
                }
                
                let endTurnChecks = {
                    //all the checks to see if an end turn forcibly happens, and then set up if statements to run the change turn function if everything here is true. todo!
                }
                function abilities(cardName, abilityID, cardID) { //function for each ability.
                    function abilityWasUsed() { //if an ability was used
                        cardData["card"+cardID][1] = true; //set the marker to true; you did use that ability.
                        cardData["card"+cardID][2][abilityID]++ //up the amount of times you've used each card's ability
                    }
                    
                    //If ability 0 (Desert Caravan's Barter) was used
                    if(Number(abilityID) === 0) {
                        if(board["player" + nonActivePlayer + "Hand"].length > 0) { //if the other person has cards in their hand
                            //get a random card from their hand
                            let randomCardOfOtherPerson = board["player" + nonActivePlayer + "Hand"][Math.floor(Math.random()*board["player" + nonActivePlayer + "Hand"].length)]
                            //get rid of Desert Caravan from your hands
                            board["player" + activePlayer + "Played"].splice(board["player" + activePlayer + "Played"].indexOf(cardName, 1))
                            //add the random card to your hand
                            board["player" + activePlayer + "Played"].push(randomCardOfOtherPerson)
                            //get rid of the random card from the other person's handd
                            board["player" + nonActivePlayer + "Hand"].splice(board["player" + nonActivePlayer + "Hand"].indexOf(randomCardOfOtherPerson), 1)
                            //add desert caravan to your discard pile
                            board["player" + activePlayer + "Discard"].push([cardName, cardID])
                            //you used an ability
                            abilityWasUsed()
                            displayBoard() //redisplay the board.
                        } else {
                            //you dont have a card to take from the other person!
                        }
                    } else if(Number(abilityID) === 1) { //if ability 1 (Desert Caravan's Roadkill) was used
                        //if the other person has played a card
                        if(board["player" + nonActivePlayer + "Played"].length > 0) {
                            let listOfPlayedCards = "Card to deal damage to: "; //start off what you're going to show with a prompt
                            for(let f in board["player" + nonActivePlayer + "Played"]) { //for each of their played cards
                                listOfPlayedCards += "<button class='roadKill roadkill"+board["player" + nonActivePlayer + "Played"][f][1]+"'>"+ board["player" + nonActivePlayer + "Played"][f][0] + "</button>"
                                //add a button that when clicked you'll deal damage to that card.
                            }
                            //add this list to the page
                            $("#ability"+abilityID).parent().append(listOfPlayedCards)
                            $("#ability"+abilityID).remove() //get rid of the button to play this ability
                            $(".roadKill").click(function(){ //when you click on a card to deal damage to
                                //deal 2 damage to that card
                                cardData["card"+$(this).attr("class").replace("roadKill", "").replace("roadkill", "").replace(" ", "")][0] -= 2
                                abilityWasUsed() //used an ability
                                displayBoard() //display the board again.
                            })
                        } else {
                            //there isnt a card to deal damage to!
                        }
                    } else if(Number(abilityID) === 2) { //if ability 2 (Novice Explorer's Expedition) was used
                        //change playedcardyet to false, so you can play one more card!
                        playedCardYet = false; //if you use novice explorer multiple times, then should you be allowed to play multiple cards? Or should it be a feature that you have to use the card and then play new cards one at a time?
                        if(cardData["card"+cardID][2][abilityID]>0) { //if this card has been used more than once
                            let a = 0; //define a
                            while(a < board["player" + activePlayer + "Played"].length) { //while a in played cards
                                if(board["player" + activePlayer + "Played"][a][1]==cardID) { //if that is the played card id
                                    board["player" + activePlayer + "Played"].splice(a, 1) //get rid of that card from your played
                                    break; //i think theres a glitch here where it also deletes another of your cards but maybe thats fixed, i don't know.
                                    //stop the while loop.
                                } else {
                                    a++ //continue...
                                }
                            }
                            board["player" + activePlayer + "Discard"].push([cardName, cardID]) //add this card to the discard pile.
                        }
                        abilityWasUsed() //an ability was used
                        displayBoard() //redisplay the board
                    }
                }
                
                var nonActivePlayer = (activePlayer)%2+1 //let nonactiveplayer be the other one.
                
                function showActivePlayerCards() { //display your active cards
                    let arrayOfCards = []; //set your cards
                    for(i in board["player" + activePlayer + "Hand"]) { //for every card in your hand
                        //push it to the array
                        arrayOfCards.push("<span id = 'activeCard"+i+"' class='cardInHand cardID"+board["player" + activePlayer + "Hand"][i][1]+"'>" + board["player" + activePlayer + "Hand"][i][0] + "</span>")
                        if(!playedCardYet) { //if you haven't played a card yet, add a button to play it.
                            arrayOfCards[arrayOfCards.length - 1] +=" <button id='playCard"+i+"' class='playCardButton cardID"+board["player" + activePlayer + "Hand"][i][1]+"'>Play Card</button>"
                        } else {
                            //otherwise don't display the button saying to play the card.
                        }
                    } 
                    //push a sort cards button at the end
                    arrayOfCards.push("<button id = 'sortCards' onclick = 'sortCards(board[\"player\" + " + activePlayer + " + \"Hand\"], true)'>Sort Cards</button>")
                    $("."+activePlayer+".hand").html("Player " + activePlayer + "'s Hand: " + arrayOfCards.join(" | ")) //set it to the page, divided by |s.
                }
                function showInactivePlayerCards() { //display inactive cards
                    let arrayOfInactiveCards = []; //set the array
                    for(i in board["player" + nonActivePlayer + "Hand"]) { //for each one you get to see the back of the card
                        arrayOfInactiveCards.push("<span id = 'inactiveCard"+i+"'>" + "The back of the card lol" + "</span>")
                    } //set it to the board
                    $("."+nonActivePlayer+".hand").html("Player " + nonActivePlayer + "'s Hand: " + arrayOfInactiveCards.join(" | "))
                }
                function showActivePlayedCards() { //display your played cards
                    let arrayOfActivePlayedCards = []; //set an array
                    for(i in board["player" + activePlayer + "Played"]) { //for every played card
                        if(cardData["card"+board["player" + activePlayer + "Played"][i][1]][0]<=0) { //if this card's health is less than or equal to 0, discard it.
                            board["player" + activePlayer + "Discard"].push(board["player" + activePlayer + "Played"].splice(i, 1)[0])
                        } else { //otherwise
                            //set up a string for each card
                            let stringOfUseCards = "";
                            stringOfUseCards = stringOfUseCards + "<span id = 'playedCardActive"+i+"' class='cardID"+board["player" + activePlayer + "Played"][i][1]+"'>" + board["player" + activePlayer + "Played"][i][0] + "</span>"
                            //Add the name of the card
                            //add its health
                            stringOfUseCards = stringOfUseCards + " <span class='cardID"+board["player" + activePlayer + "Played"][i][1]+"Abilities'>Health: " + cardData["card" + board["player" + activePlayer + "Played"][i][1]][0] + "/" + cards[board["player" + activePlayer + "Played"][i][0]]["Health"]
                            if(cardData["card"+board["player" + activePlayer + "Played"][i][1]][1]) { //if you have used this card already, then you can't use it again
                                stringOfUseCards+="You've already used this card once this turn!"
                            } else { //you havent used this card yet this turn
                                for(j in cards[board["player" + activePlayer + "Played"][i][0]]["Abilities"]) { //for each of this card's abilities add a button
                                    stringOfUseCards = stringOfUseCards + " <button class='useCard"+i+" useCardButton' id='ability"+Object.values(cards[board["player" + activePlayer + "Played"][i][0]]["Abilities"][j])[0]+"'>Use Ability "+Object.keys(cards[board["player" + activePlayer + "Played"][i][0]]["Abilities"][j])[1]+"</button>"
                                }
                            }
                            stringOfUseCards = stringOfUseCards + "</span>" //close the span element
                            arrayOfActivePlayedCards.push(stringOfUseCards) //push it to the array
                        }      
                    }
                    //add it to the board, separated by |s
                    $("."+activePlayer+".played").html("Player " + activePlayer + "'s Played Cards: " + arrayOfActivePlayedCards.join(" | "))
                }
                function showInactivePlayedCards() { //show inactive played cards
                    let arrayOfInActivePlayedCards = []; //set an array
                    for(i in board["player" + nonActivePlayer + "Played"]) { //for each of them
                        if(cardData["card"+board["player" + nonActivePlayer + "Played"][i][1]][0]<=0) { //if the card has 0 or less health discard it
                            board["player" + nonActivePlayer + "Discard"].push(board["player" + nonActivePlayer + "Played"].splice(i, 1)[0])
                        } else { //otherwise
                            //set up a string
                            let stringOfPlayedCards = "";
                            stringOfPlayedCards = stringOfPlayedCards + "<span id = 'playedCardNonActive"+i+"' class='cardID"+board["player" + nonActivePlayer + "Played"][i][1]+"'>" + board["player" + nonActivePlayer + "Played"][i][0] + "</span>"
                            //add the card's name
                            //add its health
                            stringOfPlayedCards = stringOfPlayedCards + " <span>Health: " + cardData["card" + board["player" + nonActivePlayer + "Played"][i][1]][0] + "/" + cards[board["player" + nonActivePlayer + "Played"][i][0]]["Health"]
                            for(j in cards[board["player" + nonActivePlayer + "Played"][i][0]]["Abilities"]) { //for each of its abilities add itss ability name
                                stringOfPlayedCards = stringOfPlayedCards + " <span class='nonActiveCardAbility"+i+"' id='ability"+Object.values(cards[board["player" + nonActivePlayer + "Played"][i][0]]["Abilities"][j])[0]+"'>Ability "+Object.keys(cards[board["player" + nonActivePlayer + "Played"][i][0]]["Abilities"][j])[1]+"</span>"
                            }
                            stringOfPlayedCards = stringOfPlayedCards + "</span>" //close the span element off
                            arrayOfInActivePlayedCards.push(stringOfPlayedCards) //push the string to the array
                        } 
                    }
                    //display the inactive played cards
                    $("."+nonActivePlayer+".played").html("Player " + nonActivePlayer + "'s Played Cards: " + arrayOfInActivePlayedCards.join(" | "))
                }
                function showDiscardPiles() { //show the discard piles
                    if(board["player" + activePlayer + "Discard"].length === 0) { //if your discard pile is empty then just show a label.
                        $("."+activePlayer+".discard").html("Player " + activePlayer + "'s Discard Pile: ")
                    } else { //show the label and the top card's name otherwise.
                        $("."+activePlayer+".discard").html("Player " + activePlayer + "'s Discard Pile: <span class='cardID" + board["player" + activePlayer + "Discard"][board["player" + activePlayer + "Discard"].length - 1][1] + "'>" + board["player" + activePlayer + "Discard"][board["player" + activePlayer + "Discard"].length - 1][0] + "</span>")
                    }
                    //same thing for non active cards.
                    if(board["player" + nonActivePlayer + "Discard"].length === 0) {
                        $("."+nonActivePlayer+".discard").html("Player " + nonActivePlayer + "'s Discard Pile: ")
                    } else {
                        $("."+nonActivePlayer+".discard").html("Player " + nonActivePlayer + "'s Discard Pile: <span class='cardID" + board["player" + nonActivePlayer + "Discard"][board["player" + nonActivePlayer + "Discard"].length - 1][1] + "'>" + board["player" + nonActivePlayer + "Discard"][board["player" + nonActivePlayer + "Discard"].length - 1][0] + "</span>")
                    }
                }
                showActivePlayerCards() //show your hand
                showInactivePlayerCards() //show the back of the other players hand
                showActivePlayedCards() //show your played cards
                showInactivePlayedCards() //show their played cards
                showDiscardPiles() //show the discard piles

                $("."+activePlayer+".endTurn").css("display", "block") //show the end turn button for you
                $("."+nonActivePlayer+".endTurn").css("display", "none") //hide it for the other person
                $("." + activePlayer + ".draw").css("display", "block") //show your draw button <- how will drawing work in game?
                $("." + nonActivePlayer + ".draw").css("display", "none") //hide it for them
                $("#turnCount").html("Turn Count: " + turnCount) //show the turn count

                function hotkeys() { //hotkeys function for clicks/hovers
                    $(".draw")
                        .unbind('click')
                        .click(function(){
                            if(board["player" + activePlayer + "Deck"].length > 0) { //if there are cards to draw
                                //move a card from your deck to your hand.
                                board["player" + activePlayer + "Hand"].push(board["player" + activePlayer + "Deck"].splice(0, 1)[0]) //why did i have to [0] here? oh, because otherwise it would return it as [["hello", "yes"]]
                                showActivePlayerCards() //reshow your hand
                                hotkeys() //recall hotkeys so they will still work.
                            } else { //no cards left to draw
                                $(this).html("There are no more cards left to draw!")
                            }
                        })
                    //when you click draw
                    
                    $(".playCardButton").click(function(){ //if you click on the play card button
                        playedCardYet = true; //set it to true, you have played a card now!
                        board["player"+activePlayer+"Hand"].splice($(this).attr("id").replace("playCard", ""), 1) //get rid of the card from your hand
                        //add it to your played section
                        board["player"+activePlayer+"Played"].push([listOfCards[$(this).attr("class").replace("playCardButton", "").replace("cardID", "").replace(" ", "")], $(this).attr("class").replace("playCardButton", "").replace("cardID", "").replace(" ", "")])
                        showActivePlayedCards() //show your played cards
                        showActivePlayerCards() //show your hand
                        hotkeys() //recall hotkeys so they will still work.
                    })

                    $(".useCardButton").click(function(){ //if you click on a use abillity button
                        //run the abilities function (cardName, abilityID, cardID)
                        abilities(board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")][0], $(this).attr("id").replace("ability", ""), $(this).parent().attr("class").replace("cardID", "").replace("Abilities", ""))
                    })
                    
                    $(".cardInHand").hover(function(){ //if you hover over a card in your hand
                        let cardAbilityDescription = []; //set an array
                        for(i in cards[$(this).html()]["Abilities"]) { //for each ability
                            //push the array with the name: description
                            cardAbilityDescription.push(Object.keys(cards[$(this).html()]["Abilities"][i])[1] + ": " + Object.values(cards[$(this).html()]["Abilities"][i])[1])
                        }
                        //show the array separated by commas.
                        $(this).append("<span id='hovered"+$(this).attr("id").replace("activeCard", "")+"'>Abilities: " + cardAbilityDescription.join(", "))
                    }, function(){ //when you unhover over it
                        $("#hovered"+$(this).attr("id").replace("activeCard", "")).remove() //remove the explanation
                    })
                    $(".played [id^='playedCard']").hover(function(){ //same thing but if you hover over a played card.
                        let cardAbilityDescription = [];
                        for(i in cards[$(this).html()]["Abilities"]) {
                            cardAbilityDescription.push(Object.keys(cards[$(this).html()]["Abilities"][i])[1] + ": " + Object.values(cards[$(this).html()]["Abilities"][i])[1])
                        }
                        $(this).append("<span id='hovered"+$(this).attr("id")+"'>Abilities: " + cardAbilityDescription.join(", "))
                    }, function(){
                        $("#hovered"+$(this).attr("id")).remove()
                    })
                }
                hotkeys() //call the hotkeys originally so they work off the ba
            }
            //show the board when you load the page.
            displayBoard()
        }
    </script>
    <script src="scripts/abilities.js"></script> <!--access the abilities.js file <-- which has nothing (if it does, I should delete it and maybe this call to access it).-->
</body>
</html>
