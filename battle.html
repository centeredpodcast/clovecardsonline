<!DOCTYPE html>
<html lang="en">
<head>
    <title>Clove Cards</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Clove Cards, Card Game">
    <meta name="description" content="An online card game!">
    <meta name="author" content="Sapphire7x and Savanna Campbell">
</head>
<body>
    <header>
        <!--<div>
            <img>
        </div>
        <nav>
            <ul></ul>
        </nav>-->
    </header>
    <main>
        <h1>Play the Game!</h1>
        <span id="turnCount"></span>
        <div id="board">
            <button class="1 endTurn" onclick="changeTurns()" style="display: none;">End Turn</button>
            <button class="1 draw" style="display: none;">Draw</button>
            <div class="1 deck" onclick="shuffleDeck(1)"></div> <!-- this won't show anymore 'caus we show decks now-->
            <div class="1 hand"></div>
            <div class="1 played"></div>
            <div class="1 discard"></div>
            <div class="2 played"></div>
            <div class="2 discard"></div>
            <div class="2 hand"></div>
            <div class="2 deck"></div>
            <button class="2 draw" style="display: none;">Draw</button>
            <button class="2 endTurn" onclick="changeTurns()" style="display: none;">End Turn</button>
        </div>
        <!--<button class="testbutton">click me to add cards to your collection!</button>-->
    </main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> <!--jQuery!-->
    <script src="scripts/game.js"></script> <!--Calls game.js file-->
    <script src="scripts/functions.js"></script>
    
    <script src="scripts/onOpen.js"></script> <!--Calls the onOpen.js file-->
    <script>
        var listOfCards = decks[activeDeck].concat(decks[activeDeckPlayerTwo])
        //create an object that assigns each card to an id.
        var activePlayer = 1;
        var turnCount = 1;
        var updateTurn = false;
        var playedCardYet = false;
        // console.log(playerDecks.playerDeck1)
        console.log(decks[activeDeck])
        var board = {
            player1Deck: decks[activeDeck],
            player1Hand: [],
            player1Played: [],
            player1Discard: [],
            player2Deck: decks[activeDeckPlayerTwo],
            player2Hand: [],
            player2Played: [],
            player2Discard: []
        }
        function shuffle(array) {
            console.log(array)
            let currentIndex = array.length;
            let temporaryValue;
            let randomIndex;
            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1; //Lower the currentIndex

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            //console.log(Array(array))
            return array;
        }
        function returnArray(array) {
            return array;
        }
        function sortCards(array, required) {
            array = array.sort()
            returnArray(array)
            if(required) displayBoard()
        }
        function shuffleDeck(deckNumber) {
            //Set the deck to the deck but shuffled
            board["player" + deckNumber + "Deck"] = shuffle(board["player" + deckNumber + "Deck"])
            //update the html. this will be deleted.
            //$("."+deckNumber+".hand").html("Player " + deckNumber + "'s Hand: " + board["player" + deckNumber + "Hand"].join(" | "))
        }
        function changeTurns() {
            activePlayer = (activePlayer)%2+1
            turnCount++
            updateTurn = true;
            displayBoard();
            
        }
        function drawFromDeck() {
            //nothing
        }
        console.log(eligibleDeckTwo)
        if(!eligibleDeckOne) {
            $("main").html("Deck One isn't eligible to play the game!")
        } else if(!eligibleDeckTwo) {
            $("main").html("Deck Two isn't eligible to play the game!")
        } else {
            //change each card in board to ["name", id] 
            for(h in board.player1Deck) {
                board.player1Deck[h] = [board.player1Deck[h], h]
            }
            for(g in board.player2Deck) { //where are the 10s coming from

                board.player2Deck[g] = [board.player2Deck[g], Number(g)+10]
            }
            console.log(decks)
            var copyOfBoard = JSON.parse(JSON.stringify(board))
            var cardData = {
                card0: [cards[board.player1Deck[0][0]].Health, false],
                card1: [cards[board.player1Deck[1][0]].Health, false],
                card2: [cards[board.player1Deck[2][0]].Health, false],
                card3: [cards[board.player1Deck[3][0]].Health, false],
                card4: [cards[board.player1Deck[4][0]].Health, false],
                card5: [cards[board.player1Deck[5][0]].Health, false],
                card6: [cards[board.player1Deck[6][0]].Health, false],
                card7: [cards[board.player1Deck[7][0]].Health, false],
                card8: [cards[board.player1Deck[8][0]].Health, false],
                card9: [cards[board.player1Deck[9][0]].Health, false],
                card10: [cards[board.player2Deck[0][0]].Health, false],
                card11: [cards[board.player2Deck[1][0]].Health, false],
                card12: [cards[board.player2Deck[2][0]].Health, false],
                card13: [cards[board.player2Deck[3][0]].Health, false],
                card14: [cards[board.player2Deck[4][0]].Health, false],
                card15: [cards[board.player2Deck[5][0]].Health, false],
                card16: [cards[board.player2Deck[6][0]].Health, false],
                card17: [cards[board.player2Deck[7][0]].Health, false],
                card18: [cards[board.player2Deck[8][0]].Health, false],
                card19: [cards[board.player2Deck[9][0]].Health, false]
            }
            console.log(board.player2Deck)
            for(i in cardData) {
                //cardData[i].push({})
                if(Number(i.replace("card", ""))<10) {
                    let newObject = {};
                    for(j in cards[board.player1Deck[i.replace("card", "")][0]]["Abilities"]) {
                        
                        newObject[Object.values(cards[board.player1Deck[i.replace("card", "")][0]]["Abilities"][j])[0]] = 0;
                        console.log(newObject)
                        
                    }
                    cardData[i].push(newObject)
                } else {
                    let newObject = {};
                    for(j in cards[board.player2Deck[Number(i.replace("card", ""))-10][0]]["Abilities"]) {
                        
                        newObject[Object.values(cards[board.player2Deck[Number(i.replace("card", ""))-10][0]]["Abilities"][j])[0]] = 0;
                        console.log(newObject)
                        
                    }
                    cardData[i].push(newObject)
                    console.log(Number(i.replace("card", ""))-10)
                    
                }
            }
            console.log(cardData)
            console.log(decks)
            shuffleDeck(1)
            shuffleDeck(2)
            console.log(decks)
            decks = JSON.parse(JSON.stringify(decks))
            
            var playerDecks = { //load the decks page so we can fix the decks pls thx
                //why did it do that? 6 cards per active deck? what?
                playerDeck1: decks[activeDeck],
                playerDeck2: decks[activeDeckPlayerTwo]
            }
            //console.log(playerDecks)
            board.player1Hand = board.player1Deck.splice(0, 4)
            board.player2Hand = board.player2Deck.splice(0, 4)
            //console.log(decks)
            
            function displayBoard() {
                if(updateTurn) {
                    for(let d in cardData) {
                        cardData[d][1]=false;
                    }
                    playedCardYet = false;
                    updateTurn = false;
                }
                
                let endTurnChecks = {
                    //all the checks to see if an end turn forcibly happens, and then set up if statements to run the change turn function if everything here is true.
                }
                console.log(cardData)
                function abilities(cardName, abilityID, cardID) {
                    function abilityWasUsed() {
                        cardData["card"+cardID][1] = true;
                        cardData["card"+cardID][2][abilityID]++
                        console.log(cardData)
                    }
                    console.log(cardID)
                    //var nonActivePlayer = (activePlayer)%2+1
                    console.log(abilityID)
                    if(Number(abilityID) === 0) {
                        if(board["player" + nonActivePlayer + "Hand"].length > 0) {
                            let randomCardOfOtherPerson = board["player" + nonActivePlayer + "Hand"][Math.floor(Math.random()*board["player" + nonActivePlayer + "Hand"].length)]
                            console.log(randomCardOfOtherPerson)
                            console.log(board["player" + activePlayer + "Played"])
                            board["player" + activePlayer + "Played"].splice(board["player" + activePlayer + "Played"].indexOf(cardName, 1))
                            board["player" + activePlayer + "Played"].push(randomCardOfOtherPerson)
                            console.log(board["player" + nonActivePlayer + "Hand"])
                            board["player" + nonActivePlayer + "Hand"].splice(board["player" + nonActivePlayer + "Hand"].indexOf(randomCardOfOtherPerson), 1)
                            board["player" + activePlayer + "Discard"].push([cardName, cardID])
                            //console.log("hello")
                            //$("<div></div>").html(randomCardOfOtherPerson)
                            //console.log("hello")
                            abilityWasUsed()
                            displayBoard()
                        } else {
                            //you dont have a card to take from the other person!
                        }
                        
                    } else if(Number(abilityID) === 1) {
                        console.log("hello")
                        if(board["player" + nonActivePlayer + "Played"].length > 0) {
                            let listOfPlayedCards = "Card to deal damage to: ";
                            for(let f in board["player" + nonActivePlayer + "Played"]) {
                                listOfPlayedCards += "<button class='roadKill roadkill"+board["player" + nonActivePlayer + "Played"][f][1]+"'>"+ board["player" + nonActivePlayer + "Played"][f][0] + "</button>"
                                //console.log(".roadkill"+board["player" + nonActivePlayer + "Played"][f][1])
                                
                                
                            }
                            
                            $("#ability"+abilityID).parent().append(listOfPlayedCards)
                            $("#ability"+abilityID).remove()
                            $(".roadKill").click(function(){
                                cardData["card"+$(this).attr("class").replace("roadKill", "").replace("roadkill", "").replace(" ", "")][0] -= 2
                                abilityWasUsed()
                                displayBoard()
                                //delete that and implement a way to deplete 2 health from a card
                                //checks for if a card has 0 health left? do that in show active played cards and show inactive played cards, I think.
                            })
                            
                        } else {
                            console.log("dslf;")
                            //there isnt a card to deal damage to!
                        }
                    } else if(Number(abilityID) === 2) {
                        //novice explorer's ability
                        playedCardYet = false;
                        let cardArray = [cardName, cardID]
                        console.log(Array([cardName, cardID]))
                        console.log(board["player" + activePlayer + "Played"])
                        console.log(board["player" + activePlayer + "Played"].indexOf(cardArray))
                        console.log(cardArray)
                        if(cardData["card"+cardID][2][abilityID]>0) {
                            let a = 0;
                            while(a < board["player" + activePlayer + "Played"].length) {
                                if(board["player" + activePlayer + "Played"][a][1]==cardID) {
                                    board["player" + activePlayer + "Played"].splice(a, 1)
                                    break; //i think theres a glitch here where it also deletes another of your cards but maybe thats fixed, i don't know.
                                } else {
                                    a++
                                }
                            }
                            //board["player" + activePlayer + "Played"].splice(board["player" + activePlayer + "Played"].indexOf(cardArray), 1)
                            board["player" + activePlayer + "Discard"].push([cardName, cardID])
                        }
                        abilityWasUsed()
                        displayBoard()
                        //if(cardData["card"+cardID])
                    }
                    
                }
                
                var nonActivePlayer = (activePlayer)%2+1
                console.log(cardData)
                function showActivePlayerCards() {
                    let arrayOfCards = [];
                    for(i in board["player" + activePlayer + "Hand"]) {
                        arrayOfCards.push("<span id = 'activeCard"+i+"' class='cardInHand cardID"+board["player" + activePlayer + "Hand"][i][1]+"'>" + board["player" + activePlayer + "Hand"][i][0] + "</span>")
                        if(!playedCardYet) {
                            arrayOfCards[arrayOfCards.length - 1] +=" <button id='playCard"+i+"' class='playCardButton cardID"+board["player" + activePlayer + "Hand"][i][1]+"'>Play Card</button>"
                            
                        } else {
                            //don't display the button saying to play the card.
                        }
                    }
                    arrayOfCards.push("<button id = 'sortCards' onclick = 'sortCards(board[\"player\" + " + activePlayer + " + \"Hand\"], true)'>Sort Cards</button>")
                    $("."+activePlayer+".hand").html("Player " + activePlayer + "'s Hand: " + arrayOfCards.join(" | "))
                }
                function showInactivePlayerCards() {
                    let arrayOfInactiveCards = [];
                    for(i in board["player" + nonActivePlayer + "Hand"]) {
                        arrayOfInactiveCards.push("<span id = 'inactiveCard"+i+"'>" + "The back of the card lol" + "</span>")
                    }
                    $("."+nonActivePlayer+".hand").html("Player " + nonActivePlayer + "'s Hand: " + arrayOfInactiveCards.join(" | "))
                }
                function showActivePlayedCards() {
                    let arrayOfActivePlayedCards = [];
                    for(i in board["player" + activePlayer + "Played"]) {
                        if(cardData["card"+board["player" + activePlayer + "Played"][i][1]][0]<=0) {
                            board["player" + activePlayer + "Discard"].push(board["player" + activePlayer + "Played"].splice(i, 1)[0])
                        } else {
                            //get amount of abilities card has
                            let stringOfUseCards = "";
                            stringOfUseCards = stringOfUseCards + "<span id = 'playedCardActive"+i+"' class='cardID"+board["player" + activePlayer + "Played"][i][1]+"'>" + board["player" + activePlayer + "Played"][i][0] + "</span>"
                            //console.log(playerDecks)
                            //the number used to get the cards' health is off...
                            //console.log(board["player" + activePlayer + "Hand"].concat(board["player" + activePlayer + "Deck"]))
                            console.log(board["player" + activePlayer + "Played"][i])
                            stringOfUseCards = stringOfUseCards + " <span class='cardID"+board["player" + activePlayer + "Played"][i][1]+"Abilities'>Health: " + cardData["card" + board["player" + activePlayer + "Played"][i][1]][0] + "/" + cards[board["player" + activePlayer + "Played"][i][0]]["Health"]
                            if(cardData["card"+board["player" + activePlayer + "Played"][i][1]][1]) {
                                stringOfUseCards+="You've already used this card once this turn!"
                            } else {
                                for(j in cards[board["player" + activePlayer + "Played"][i][0]]["Abilities"]) {
                                    stringOfUseCards = stringOfUseCards + " <button class='useCard"+i+" useCardButton' id='ability"+Object.values(cards[board["player" + activePlayer + "Played"][i][0]]["Abilities"][j])[0]+"'>Use Ability "+Object.keys(cards[board["player" + activePlayer + "Played"][i][0]]["Abilities"][j])[1]+"</button>"
                                }
                            }
                            
                            arrayOfActivePlayedCards.push(stringOfUseCards)
                            //for each ability add a string which has <button id='"+j+"useCard"+i+"' class='useCardButton'>Use Ability "+k+"</button> to the string below>>
                            //where k is the name of the ability, j is the #ability the card has and i is the id of the card being played.
                            //arrayOfActivePlayedCards.push("<span id = 'playedCardActive"+i+"'>" + board["player" + activePlayer + "Played"][i] + "</span>")
                        }
                        
                    }
                    $("."+activePlayer+".played").html("Player " + activePlayer + "'s Played Cards: " + arrayOfActivePlayedCards.join(" | "))
                }
                function showInactivePlayedCards() {
                    let arrayOfInActivePlayedCards = [];
                    for(i in board["player" + nonActivePlayer + "Played"]) {
                        if(cardData["card"+board["player" + nonActivePlayer + "Played"][i][1]][0]<=0) {
                            board["player" + nonActivePlayer + "Discard"].push(board["player" + nonActivePlayer + "Played"].splice(i, 1)[0])
                        } else {
                            //get amount of abilities card has
                            let stringOfPlayedCards = "";
                            stringOfPlayedCards = stringOfPlayedCards + "<span id = 'playedCardNonActive"+i+"' class='cardID"+board["player" + nonActivePlayer + "Played"][i][1]+"'>" + board["player" + nonActivePlayer + "Played"][i][0] + "</span>"
                            //console.log(playerDecks)
                            //the number used to get the cards' health is off...
                            //console.log(board["player" + activePlayer + "Hand"].concat(board["player" + activePlayer + "Deck"]))
                            stringOfPlayedCards = stringOfPlayedCards + " <span>Health: " + cardData["card" + board["player" + nonActivePlayer + "Played"][i][1]][0] + "/" + cards[board["player" + nonActivePlayer + "Played"][i][0]]["Health"]
                            console.log(board["player" + nonActivePlayer + "Played"][i])
                            for(j in cards[board["player" + nonActivePlayer + "Played"][i][0]]["Abilities"]) {
                                stringOfPlayedCards = stringOfPlayedCards + " <span class='nonActiveCardAbility"+i+"' id='ability"+Object.values(cards[board["player" + nonActivePlayer + "Played"][i][0]]["Abilities"][j])[0]+"'>Ability "+Object.keys(cards[board["player" + nonActivePlayer + "Played"][i][0]]["Abilities"][j])[1]+"</span>"
                            }
                            arrayOfInActivePlayedCards.push(stringOfPlayedCards)
                            //for each ability add a string which has <button id='"+j+"useCard"+i+"' class='useCardButton'>Use Ability "+k+"</button> to the string below>>
                            //where k is the name of the ability, j is the #ability the card has and i is the id of the card being played.
                            //arrayOfActivePlayedCards.push("<span id = 'playedCardActive"+i+"'>" + board["player" + activePlayer + "Played"][i] + "</span>")
                        }
                        
                    }
                    $("."+nonActivePlayer+".played").html("Player " + nonActivePlayer + "'s Played Cards: " + arrayOfInActivePlayedCards.join(" | "))
                }
                function showDiscardPiles() {
                    if(board["player" + activePlayer + "Discard"].length === 0) {
                        $("."+activePlayer+".discard").html("Player " + activePlayer + "'s Discard Pile: ")
                    } else {
                        $("."+activePlayer+".discard").html("Player " + activePlayer + "'s Discard Pile: <span class='cardID" + board["player" + activePlayer + "Discard"][board["player" + activePlayer + "Discard"].length - 1][1] + "'>" + board["player" + activePlayer + "Discard"][board["player" + activePlayer + "Discard"].length - 1][0] + "</span>")
                    }
                    if(board["player" + nonActivePlayer + "Discard"].length === 0) {
                        $("."+nonActivePlayer+".discard").html("Player " + nonActivePlayer + "'s Discard Pile: ")
                    } else {
                        console.log(board["player" + nonActivePlayer + "Discard"].length - 1)
                        console.log(board["player" + nonActivePlayer + "Discard"][board["player" + nonActivePlayer + "Discard"].length - 1])
                        console.log("lol")
                        $("."+nonActivePlayer+".discard").html("Player " + nonActivePlayer + "'s Discard Pile: <span class='cardID" + board["player" + nonActivePlayer + "Discard"][board["player" + nonActivePlayer + "Discard"].length - 1][1] + "'>" + board["player" + nonActivePlayer + "Discard"][board["player" + nonActivePlayer + "Discard"].length - 1][0] + "</span>")
                    }
                }

                showActivePlayerCards()
                showInactivePlayerCards()
                showActivePlayedCards()
                showInactivePlayedCards()
                showDiscardPiles()
                console.log(cardData)
                $("."+activePlayer+".endTurn").css("display", "block")
                $("."+nonActivePlayer+".endTurn").css("display", "none")
                $("." + activePlayer + ".draw").css("display", "block")
                $("." + nonActivePlayer + ".draw").css("display", "none")
                $("#turnCount").html("Turn Count: " + turnCount)

                function hotkeys() {
                    $(".draw")
                        .unbind('click')
                        .click(function(){
                            if(board["player" + activePlayer + "Deck"].length > 0) {
                                console.log(board["player" + activePlayer + "Deck"][0])
                                console.log(board["player" + activePlayer + "Hand"])
                                board["player" + activePlayer + "Hand"].push(board["player" + activePlayer + "Deck"].splice(0, 1)[0]) //why did i have to [0] here? oh, because otherwise it would return it as [["hello", "yes"]]
                                console.log(board["player" + activePlayer + "Hand"])
                                showActivePlayerCards()
                                hotkeys()
                            } else {
                                $(this).html("There are no more cards left to draw!")
                            }
                        })
                    
                    $(".playCardButton").click(function(){
                        playedCardYet = true;
                        board["player"+activePlayer+"Hand"].splice($(this).attr("id").replace("playCard", ""), 1)
                        board["player"+activePlayer+"Played"].push([listOfCards[$(this).attr("class").replace("playCardButton", "").replace("cardID", "").replace(" ", "")], $(this).attr("class").replace("playCardButton", "").replace("cardID", "").replace(" ", "")])
                        //i very much dislike this use of .prev()
                        showActivePlayedCards()
                        showActivePlayerCards()
                        hotkeys()
                    })

                    $(".useCardButton").click(function(){
                        console.log(cardData)
                        /* for(i in cardData["card" + $(this).parent().attr("class").replace("cardID", "").replace("Abilities", "")][2]) {
                            //if(Object.keys(cardData["card" + $(this).parent().attr("class").replace("cardID", "").replace("Abilities", "")][2][i])[0]==$(this).attr("id").replace("ability", "")) {
                            cardData["card" + $(this).parent().attr("class").replace("cardID", "").replace("Abilities", "")][2][i][$(this).attr("id").replace("ability", "")]++
                            //make this work
                            //why did cardData disappear?
                            //should this go at the end of the abilities function anyway>
                        } */
                        //cardData["card"+$(this).attr("id").replace("ability", "")][2]
                        abilities(board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")][0], $(this).attr("id").replace("ability", ""), $(this).parent().attr("class").replace("cardID", "").replace("Abilities", ""))
                        //console.log(board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")])
                        //$(this).html(cards[board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")]]["Abilities"][$(this).html().replace("Use Ability ", "")][0])
                    })
                    let previousHTML = "";
                    $(".cardInHand").hover(function(){
                        let cardAbilityDescription = [];
                        previousHTML = $(this).html()
                        for(i in cards[$(this).html()]["Abilities"]) {
                            cardAbilityDescription.push(Object.keys(cards[$(this).html()]["Abilities"][i])[1] + ": " + Object.values(cards[$(this).html()]["Abilities"][i])[1])
                        }
                        $(this).append("<span id='hovered"+$(this).attr("id").replace("activeCard", "")+"'>Abilities: " + cardAbilityDescription.join(", "))
                    }, function(){
                        $("#hovered"+$(this).attr("id").replace("activeCard", "")).remove()
                        previousHTML=""
                    })
                }
                hotkeys()
                console.log(cardData)
                
            }
            displayBoard()
            console.log(cardData)
            //$(".2.hand").html("Player Two's Hand: " + board.player2Hand.join(" | "))
            //$(".1.hand").html("Player One's Hand: " + board.player1Hand.join(" | "))
        }
    </script>
    <script src="scripts/abilities.js"></script>
</body>
</html>
