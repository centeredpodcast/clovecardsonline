<!DOCTYPE html>
<html lang="en">
<head>
    <title>Clove Cards</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="Clove Cards, Card Game">
    <meta name="description" content="An online card game!">
    <meta name="author" content="Sapphire7x and Savanna Campbell">
</head>
<body>
    <header>
        <!--<div>
            <img>
        </div>
        <nav>
            <ul></ul>
        </nav>-->
    </header>
    <main>
        <h1>Play the Game!</h1>
        <span id="turnCount"></span>
        <div id="board">
            <button class="1 endTurn" onclick="changeTurns()" style="display: none;">End Turn</button>
            <div class="1 deck" onclick="shuffleDeck(1)"></div> <!-- this won't show anymore 'caus we show decks now-->
            <div class="1 hand"></div>
            <div class="1 played"></div>
            <div class="1 discard"></div>
            <div class="2 played"></div>
            <div class="2 discard"></div>
            <div class="2 hand"></div>
            <div class="2 deck"></div>
            <button class="2 endTurn" onclick="changeTurns()" style="display: none;">End Turn</button>
        </div>
        <!--<button class="testbutton">click me to add cards to your collection!</button>-->
    </main>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script> <!--jQuery!-->
    <script src="scripts/game.js"></script> <!--Calls game.js file-->
    <script src="scripts/functions.js"></script>
    
    <script src="scripts/onOpen.js"></script> <!--Calls the onOpen.js file-->
    <script>
        var activePlayer = 1;
        var turnCount = 1;
        var board = {
            player1Deck: decks[activeDeck],
            player1Hand: [],
            player1Played: [],
            player1Discard: [],
            player2Deck: decks[activeDeckPlayerTwo],
            player2Hand: [],
            player2Played: [],
            player2Discard: []
        }
        function shuffle(array) {
            console.log(array)
            let currentIndex = array.length;
            let temporaryValue;
            let randomIndex;
            // While there remain elements to shuffle...
            while (0 !== currentIndex) {

                // Pick a remaining element...
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1; //Lower the currentIndex

                // And swap it with the current element.
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            //console.log(Array(array))
            return array;
        }
        function returnArray(array) {
            return array;
        }
        function sortCards(array, required) {
            array = array.sort()
            returnArray(array)
            if(required) displayBoard()
        }
        function shuffleDeck(deckNumber) {
            //Set the deck to the deck but shuffled
            board["player" + deckNumber + "Deck"] = shuffle(board["player" + deckNumber + "Deck"])
            //update the html. this will be deleted.
            //$("."+deckNumber+".hand").html("Player " + deckNumber + "'s Hand: " + board["player" + deckNumber + "Hand"].join(" | "))
        }
        function changeTurns() {
            activePlayer = (activePlayer)%2+1
            turnCount++
            displayBoard();
            
        }
        
        if(!eligibleDeckOne) {
            $("main").html("Deck One isn't eligible to play the game!")
        } else if(!eligibleDeckTwo) {
            $("main").html("Deck Two isn't eligible to play the game!")
        } else {
            shuffleDeck(1)
            shuffleDeck(2)
            board.player1Hand = board.player1Deck.splice(0, 4)
            board.player2Hand = board.player2Deck.splice(0, 4)
            function displayBoard() {
                function abilities(cardName, abilityID) {
                    //var nonActivePlayer = (activePlayer)%2+1
                    console.log(abilityID)
                    if(Number(abilityID) === 0) {
                        console.log('asdflk')
                        let randomCardOfOtherPerson = board["player" + nonActivePlayer + "Hand"][Math.floor(Math.random()*board["player" + nonActivePlayer + "Hand"].length)]
                        //console.log(randomCardOfOtherPerson)
                        board["player" + activePlayer + "Played"].splice(board["player" + activePlayer + "Played"].indexOf(cardName, 1))
                        board["player" + activePlayer + "Played"].push(randomCardOfOtherPerson)
                        board["player" + nonActivePlayer + "Hand"].splice(board["player" + nonActivePlayer + "Hand"].indexOf(randomCardOfOtherPerson), 1)
                        board["player" + activePlayer + "Discard"].push(cardName)
                        //console.log("hello")
                        //$("<div></div>").html(randomCardOfOtherPerson)
                        //console.log("hello")
                        displayBoard()
                    }
                    
                }
                var nonActivePlayer = (activePlayer)%2+1
                let arrayOfCards = [];
                for(i in board["player" + activePlayer + "Hand"]) {
                    arrayOfCards.push("<span id = 'activeCard"+i+"'>" + board["player" + activePlayer + "Hand"][i] + "</span> <button id='playCard"+i+"' class='playCardButton'>Play Card</button>")
                }
                arrayOfCards.push("<button id = 'sortCards' onclick = 'sortCards(board[\"player\" + " + activePlayer + " + \"Hand\"], true)'>Sort Cards</button>")
                let arrayOfInactiveCards = [];
                for(i in board["player" + nonActivePlayer + "Hand"]) {
                    arrayOfInactiveCards.push("<span id = 'inactiveCard"+i+"'>" + "The back of the card lol" + "</span>")
                }
                let arrayOfActivePlayedCards = [];
                for(i in board["player" + activePlayer + "Played"]) {
                    //get amount of abilities card has
                    let stringOfUseCards = "";
                    stringOfUseCards = stringOfUseCards + "<span id = 'playedCardActive"+i+"'>" + board["player" + activePlayer + "Played"][i] + "</span>"
                    for(j in cards[board["player" + activePlayer + "Played"][i]]["Abilities"]) {
                        stringOfUseCards = stringOfUseCards + " <button class='useCard"+i+" useCardButton' id='ability"+Object.values(cards[board["player" + activePlayer + "Played"][i]]["Abilities"][j])[0]+"'>Use Ability "+Object.keys(cards[board["player" + activePlayer + "Played"][i]]["Abilities"][j])[1]+"</button>"
                    }
                    arrayOfActivePlayedCards.push(stringOfUseCards)
                    //for each ability add a string which has <button id='"+j+"useCard"+i+"' class='useCardButton'>Use Ability "+k+"</button> to the string below>>
                    //where k is the name of the ability, j is the #ability the card has and i is the id of the card being played.
                    //arrayOfActivePlayedCards.push("<span id = 'playedCardActive"+i+"'>" + board["player" + activePlayer + "Played"][i] + "</span>")
                }
                let arrayOfNonactivePlayedCards = [];
                for(i in board["player" + nonActivePlayer + "Played"]) {
                    //the nonactive side is fine- you can't use nonactive cards lol
                    arrayOfNonactivePlayedCards.push("<span id = 'playedCardNonActive"+i+"'>" + board["player" + nonActivePlayer + "Played"][i] + "</span>")
                }
                $("."+activePlayer+".hand").html("Player " + activePlayer + "'s Hand: " + arrayOfCards.join(" | "))
                $("."+nonActivePlayer+".hand").html("Player " + nonActivePlayer + "'s Hand: " + arrayOfInactiveCards.join(" | "))
                $("."+activePlayer+".played").html("Player " + activePlayer + "'s Played Cards: " + arrayOfActivePlayedCards.join(" | "))
                $("."+nonActivePlayer+".played").html("Player " + nonActivePlayer + "'s Played Cards: " + arrayOfNonactivePlayedCards.join(" | "))
                
                $("."+activePlayer+".endTurn").css("display", "block")
                $("."+nonActivePlayer+".endTurn").css("display", "none")

                if(board["player" + activePlayer + "Discard"].length === 0) {
                    $("."+activePlayer+".discard").html("Player " + activePlayer + "'s Discard Pile: ")
                } else {
                    $("."+activePlayer+".discard").html("Player " + activePlayer + "'s Discard Pile: " + board["player" + activePlayer + "Discard"][board["player" + activePlayer + "Discard"].length - 1])
                }
                if(board["player" + nonActivePlayer + "Discard"].length === 0) {
                    $("."+nonActivePlayer+".discard").html("Player " + nonActivePlayer + "'s Discard Pile: ")
                } else {
                    $("."+nonActivePlayer+".discard").html("Player " + nonActivePlayer + "'s Discard Pile: " + board["player" + nonActivePlayer + "Discard"][board["player" + nonActivePlayer + "Discard"].length - 1])
                }

                $("#turnCount").html("Turn Count: " + turnCount)
                $(".playCardButton").click(function(){
                    board["player"+activePlayer+"Hand"].splice($(this).attr("id").replace("playCard", ""), 1)
                    board["player"+activePlayer+"Played"].push($(this).prev().html())
                    displayBoard()
                })
                $(".useCardButton").click(function(){
                    //console.log("hello")
                    //console.log(cards[board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")]]["Abilities"][$(this).html().replace("Use Ability ", "")][0])
                    //console.log($(this).html().replace("Use Ability ", ""))
                    console.log($(this).attr("id").replace("ability", ""))
                    //console.log(cards[board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")]]["Abilities"][$(this).html().replace("Use Ability ", "")][0])
                    abilities(board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")], $(this).attr("id").replace("ability", ""))
                    //console.log(board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")])
                    //$(this).html(cards[board["player"+activePlayer+"Played"][$(this).attr("class").replace("useCardButton", "").replace("useCard", "").replace(" ", "")]]["Abilities"][$(this).html().replace("Use Ability ", "")][0])
                })
            }
            displayBoard()
            
            //$(".2.hand").html("Player Two's Hand: " + board.player2Hand.join(" | "))
            //$(".1.hand").html("Player One's Hand: " + board.player1Hand.join(" | "))
        }
    </script>
    <script src="scripts/abilities.js"></script>
</body>
</html>
